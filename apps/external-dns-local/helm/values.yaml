# External-DNS for Local Network with Unbound Webhook
# This deploys external-dns configured to use the Unbound webhook provider
# for automatic DNS management on your local network.

external-dns:
  # Domain filtering - only manage .local domains
  domainFilters:
    - tryy3.local # CHANGE THIS to your local domain

  # Label filter - only process resources with this label
  labelFilter: external-dns-local==enabled

  sources: ["service"]
  logLevel: debug
  logFormat: json

  policy: sync
  registry: noop

  # Provider configuration - use webhook for Unbound
  provider:
    name: webhook
    webhook:
      image:
        repository: ghcr.io/guillomep/external-dns-unbound-webhook
        tag: v0.1.3
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
        privileged: false
        readOnlyRootFilesystem: true
        runAsGroup: 65532
        runAsNonRoot: true
        runAsUser: 65532
      env:
        # Unbound server configuration
        # IMPORTANT: Change these to match your Unbound server!
        - name: UNBOUND_HOST
          value: "192.168.1.3" # ← Your Unbound server IP/hostname
        - name: UNBOUND_PORT
          value: "8953"

        # Domain filter
        - name: DOMAIN_FILTER
          value: "tryy3.local" # ← Your local domain

        # Logging
        - name: LOG_LEVEL
          value: "debug"

        # Optional: Dry run mode (set to "true" for testing)
        - name: DRY_RUN
          value: "false"
